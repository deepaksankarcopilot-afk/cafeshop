<div class="container mt-5">
  <h2 class="mb-4">Role Management</h2>
  <div class="mb-3 d-flex">
  <input type="text" [(ngModel)]="newRole.name" class="form-control form-control-sm mb-2 w-auto" style="min-width: 120px; max-width: 200px;" placeholder="Enter new role" />
      <label class="form-label">Map Screens to Role:</label>
      <div class="mb-2">
        <div *ngFor="let screen of availableScreens" class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" [value]="screen" [(ngModel)]="newRole.screens" [ngModelOptions]="{standalone: true}" [checked]="newRole.screens.includes(screen)" (change)="onScreenToggle(screen, $event)" />
          <label class="form-check-label">{{ screen }}</label>
        </div>
      </div>
    <button (click)="addRole()" class="btn btn-primary">Add Role</button>
  </div>
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Role Name</th>
          <th *ngFor="let screen of availableScreens">{{ screen | titlecase }}</th>
          <th style="width: 140px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let role of roles">
          <ng-container *ngIf="editRole && editRole.id === role.id; else viewModeRow"></ng-container>
          <tr *ngIf="editRole && editRole.id === role.id">
            <td>
              <input type="text" [(ngModel)]="editRole.name" class="form-control form-control-sm w-auto" style="min-width: 120px; max-width: 200px;" placeholder="Role name" />
            </td>
            <td *ngFor="let screen of availableScreens" class="text-center">
              <input class="form-check-input" type="checkbox" [value]="screen" [(ngModel)]="editRole.screens" [ngModelOptions]="{standalone: true}" [checked]="editRole.screens && editRole.screens.includes(screen)" (change)="onEditScreenToggle(screen, $event)" />
            </td>
            <td>
              <button (click)="updateRole()" class="btn btn-success btn-sm me-1">Save</button>
              <button (click)="cancelEdit()" class="btn btn-secondary btn-sm">Cancel</button>
            </td>
          </tr>
          <tr *ngIf="!editRole || editRole.id !== role.id">
            <td><strong>{{ role.name }}</strong></td>
            <td *ngFor="let screen of availableScreens" class="text-center">
              <span *ngIf="role.screens && role.screens.includes(screen)" class="text-success"><i class="bi bi-check-lg"></i>âœ”</span>
            </td>
            <td>
              <button (click)="edit(role)" class="btn btn-warning btn-sm me-1">Edit</button>
              <button (click)="deleteRole(role.id)" class="btn btn-danger btn-sm">Delete</button>
            </td>
          </tr>
        </tr>
      </tbody>
    </table>
  </div>
</div>
